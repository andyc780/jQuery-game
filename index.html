<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Blitz Clicker</title>
    <link rel="stylesheet" href="style.css">
</head>
<body>
    <!-- The welcome menu that lets you choose the difficulty of the game and start it. -->
    <div class="intro-menu">
        <div class="intro-items">
            <h1>Blitz Clicker</h1>
            <h2>Choose Difficulty</h2>
            <div class="difficulty">
                <button class="normal-button">Normal</button>
                <button class="expert-button">Expert</button>
            </div>
            <div class="difficulty-message"></div>
            <br>
            <button class="submit">Start Game</button>
        </div>
    </div>
<div class="banners">
    <div class="s-1-box">
        <div class="stage-1-banner">
            <h2> Stage 1 </h2>
            <h4>Humble Begnninngs</h4>
            <h4>What advendtures lie ahead of you?</h4>
            <h4>(No effects here)</h4>
        </div>
    </div>
    <div class="s-2-box">
        <div class="stage-2-banner">
            <h2>Stage 2</h2>
            <h4>Rising Heights</h4>
            <h4>Going up... and never back down.</h4>
            <h4> +30 Points, +10 HP</h4>
        </div>
    </div>
    <div class="s-3-box">
        <div class="stage-3-banner">
            <h2>Stage 3</h2>
            <h4>Soaring Above the Clouds</h4>
            <h4>Pretty high up here huh?</h4>
            <h4> +15 HP, +50 Points</h4>
        </div>
    </div>
    <div class="s-4-box">
        <div class="stage-4-banner">
            <h2>Final Stage</h2>
            <h4>Into the Starry Night</h4>
            <h4>You begin to grow weaker as time passes...</h4>
            <h4> +80 Points, Accuracy % Boost</h4>
        </div>
    </div>
    <div class="f-box fatigue-1">
        <div class="fatigue-1-banner">
            <h2>Fatigue Sets In</h2>
            <h4>Your body begins to relax...</h4>
            <h4> -5 HP, x2 Accuracy Penalty</h4>
        </div>
    </div>
    <div class="f-box fatigue-2">
        <div class="fatigue-2-banner">
            <h2>Your Consciousness Fades...</h2>
            <h4>It's getting dark...</h4>
            <h4> -10 HP, + Point Gain Reduced by 1. </h4>
        </div>
    </div>
    <div class="f-box fatigue-3">
        <div class="fatigue-3-banner">
            <h2>Exhaustion.</h2>
            <h4>This is the end. It's over</h4>
            <h4>Your health decays (-1 HP/4 Seconds)</h4>
            <h4>Health Reduction Penalty Doubled.</h4>
            <h4> +5 Tile Density</h4>
        </div>
    </div>
</div>
    <!-- The menu when the game is over, displays the final score and other statistics. -->
    <div class="game-over-menu">
        <div class="game-over-items">
            <h1 class="over-title">Game Over!</h1>
            <h2 class="final-score">Your Final Score: -</h2>
            <div class="acc-game-over">
                <h4 class="g-acc">Accuracy -%</h4> <h4 class="raw-acc">Raw Score: -</h4>
            </div>
            <h3 class ="p-ups-obtained">Powerups Obtained:</h3>
            <h3 class ="time-elapsed">Time Survived: -:-:-.-</h3>
            <div class="end-quote"><em>"Random End Quote Here. Resistance is futile, rest easy now."</em></div>
            <div class="restart-button">
                <button class="restart">Restart Game</button>
            </div>
        </div>
    </div>

    <!-- When you pause the game, this menu will show up. -->
    <div class="pause-menu">
        <div class="pause-items">
            <h1>Game Paused!</h1>
            <div class="game-buttons pause-spacer">
                <button class="resume">Resume Game</button>
                <button class="end-game">End Game</button>
            </div>
        </div>
    </div>
    <!-- Hidden area that will display the countdown in the middle of the screen -->
    <div class="countdown-area">
        Get Ready!
    </div>
    
    <!-- The entire game board for the normal selected difficulty. -->
     <!-- Each will have their own grid and statistics chart. -->
    <div class="spacing-container container">
        <div class="main-grid-container-normal">
            <div class="row-1">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-2">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-3">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-4">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-5">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
         </div>
         <div class="statistics-container normal-stat">
            <div class="stats">
                <h3 class="score">Score:<span style = "color:#2eb8b5"> 0 </span></h3>
                <h3 class="acc">Accuracy:<span style = "color:#429820">100.00% </span></h3>
                <h3 class="hp">Health: <span style ="color:#ec4048">-- HP</span></h3>
                <h3 class="time-elapsed">Time Elapsed:  <span style = "color:#eba442">0:0:0.0 </span></h3> <!-- hrs:mins:secs.ms format of time elasped-->
                <div class="game-buttons">
                    <button class="pause">Pause (P)</button>
                    <button class="end-game">End Game (esc)</button>
                </div>
            </div>
            <div class="effects-container">
                <h3>Effects</h3>
            </div>
        </div>
    </div>

    <!-- The entire game board for the expert difficulty.
    All statistics are the same from normal, just reduced hp. -->
    <div class="spacing-container container">
        <div class="main-grid-container-expert">
            <div class="row-1">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-2">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-3">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-4">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-5">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
            <div class="row-6">
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
                <button> </button>
            </div>
        </div>
        <div class="statistics-container expert-stat">
            <div class="stats">
                <h3 class="score"> Score:<span style = "color:#2eb8b5"> 0 </span></h3>
                <h3 class="acc">Accuracy:<span style = "color:#429820">100.00% </span></h3>
                <h3 class="hp">Health: <span style ="color:#ec4048">-- HP</span></h3>
                <h3 class="time-elapsed">  Time Elapsed: <span style = "color:#eba442">0:0:0.0</span></h3> <!-- hrs:mins:secs.ms format of time elasped-->
                <div class="game-buttons">
                    <button class="pause">Pause (P)</button>
                    <button class="end-game">End Game (esc)</button>
                </div>
            </div>
            <div class="effects-container">
                <h3>Current Effects</h3>
            </div>
        </div>
    </div>
</body>

<script src="https://code.jquery.com/jquery-3.7.1.js" integrity="sha256-eKhayi8LEQwp4NKxN+CfCh+3qOVUtJn3QNZ0TciWLP4=" crossorigin="anonymous"></script>
<script>
    // welcome to all of my pain and suffering inside of this file, good luck going through it.


    $(".game-over-menu").hide();
    $(".statistics-container").hide();
    $(".main-grid-container-normal").hide();
    $(".main-grid-container-expert").hide();
    $(".pause-menu").hide();
    $(".countdown-area").hide();

    $(".s-1-box").hide();
    $(".s-2-box").hide();
    $(".s-3-box").hide();
    $(".s-4-box").hide();
    $(".fatigue-1").hide();
    $(".fatigue-2").hide();
    $(".fatigue-3").hide();

    // $(".fatigue-3").show();


    $(document).ready(function(){
        // $(".intro-menu").hide();
        // intitalize variables for the game
        // Normal difficulty will be default if the user does not interact with any of the buttons
        let difficulty = "normal";
        let timerElapsed;
        let timer;
        let score = 0;
        let accuracyBuffer = 10; // adds some leniency to the accuracy calculation 
        let totalCount = 0 + accuracyBuffer;
        let misses = 0;
        let accuracy = 1;
        let health;
        let maxHealth;
        let temp;
        let totalPowerupsCollected = 0;
        let inGame = false;
        let isPaused = false;
        let hazeEffect = false; // since pause fades opacity, we need to check if the haze effect is active when resuming or else the effect is lost

        
        // slide in animation for the menu when the document is ready
        $(".intro-menu").css({
            top: '48%',
            opacity: 0
        }).animate({
            top: '50%',
            opacity: 1
        },1000);


        $(".normal-button").on("click", function(){
            difficulty = "normal";
            $('.intro-menu').css({
                backgroundColor: '#ebdf8a',
                color: '#333',
            }); 
            
            $(".difficulty-message").html('<em>"For those that are willing to embark on an ordinary path.</em>');
            $(".difficulty-message").fadeOut(0);
            $(".difficulty-message").fadeIn(750);
        });
        $(".expert-button").on("click", function(){
            difficulty = "expert";
            $('.intro-menu').css({
                backgroundColor: '#a10b1a',
                color: '#f2bbbb',
                
            });
            $(".difficulty-message").html('<em>"Strength is futile in the midst of chaos and destruction."</em');
            $(".difficulty-message").fadeOut(0);
            $(".difficulty-message").fadeIn(750);
        });

        $(".submit").on("click", function(){
            $(".intro-menu").fadeOut(300);
            if(difficulty == "normal"){
                $(".main-grid-container-normal").fadeIn(1000);
                $(".normal-stat").fadeIn(1000);
            }
            else if(difficulty == "expert")
            {
                $(".main-grid-container-expert").fadeIn(1000);
                $(".expert-stat").fadeIn(1000);
            }
            startCountDown();
        });

        $('.end-game').on("click", function(){
            clearInterval(timerElapsed);
            clearInterval(timer);
            inGame = false; // prevent pause from being clicked again
            isPaused = false;
            $(".container").fadeOut(500);
            $(".pause-menu").fadeOut(500);  
            $(".over-title").html("Game Ended Early");
            $(".game-over-menu").delay(1000).fadeIn(1000);
            $(".final-score").html("Your Final Score: <span style='color:gold; font-size:1.5rem;'>" + (score * (accuracy / 100)).toFixed(1) + "</span>");
            $(".g-acc").html("Accuracy: <span style='color:#66f224'>" + accuracy + "%</span>");
            $(".raw-acc").html("Raw Score: <span style='color:#3845d6'>" + score + "</span>");
            $(".p-ups-obtained").html("Powerups Obtained: <span style='color:#eee'>" + totalPowerupsCollected + "</span>");
            $(".time-elapsed").html('Time Elapsed: <span style="color:#eee">' + hours + ':' + minutes + ':' + seconds + '.' + miliseconds + '</span>');
        });
        // Pause when the 
        $(document).on("keydown", function(e) {
            if (e.key.toLowerCase() === "p" && inGame) {
                {
                    isPaused = true;
                    // temp = health; // store the current health so we can restore it when resuming the game
                    // console.log(temp);
                    // health = 100; // prevent death from the last set of fading blocks that may reduce health

                    // $(".hp").html('<h4>Health: <span style="color:#ec4048"> 100 HP</span></h4>'); // update the health to 1000 so it doesn't show 0 when paused
                    clearInterval(timerElapsed);
                    clearInterval(timer);
                    $(".container").animate({
                        opacity: 0.25
                    });
                    $(".pause-menu").fadeIn(300)
                    $(".pause-menu").css({
                        zIndex: 2
                    });
                    $(".container").css("pointer-events", "none"); // make the game board unable to be cliked when paused
                }
            }
        });
        $(".pause").on("click", function(){
            isPaused = true;
            // temp = health; // store the current health so we can restore it when resuming the game
            // console.log(temp);
            // health = 100; // prevent death from the last set of fading blocks that may reduce health
            // $(".hp").html('<h4>Health: <span style="color:#ec4048"> 100 HP</span></h4>'); // update the health to 1000 so it doesn't show 0 when paused
            clearInterval(timerElapsed);
            clearInterval(timer);
            $(".container").animate({
                opacity: 0.25
            });
            $(".pause-menu").fadeIn(300)
            $(".pause-menu").css({
                zIndex: 2
            });
            $(".container").css("pointer-events", "none"); // make the game board unable to be cliked when paused
        });
        
        $(document).on("keydown", function(e) {
            if (e.key === "Escape" && inGame) {
                $(".end-game").click();
            }
        });
        $(".resume").on("click", function(){
            isPaused = false;
            // // health = temp;
            // $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health + ' HP</span></h4>'); 
            clearInterval(timerElapsed);
            clearInterval(timer);
            setTimeout(function(){
                startGame(difficulty);
            },200);
            
            $(".container").css("pointer-events", "auto"); // make the game board clickable again
            if(hazeEffect == true){
                $(".container").css("opacity", 0.45);
            }
            else{
                $(".container").animate({
                    opacity: 1
                });
            }
            $(".pause-menu").fadeOut(300);
            $(".pause-menu").css({
                zIndex: -1
            });
        });

        $(".restart").on("click", function(){
            location.reload();
        });
    // all the painful logic is located starting down here. 
    // Timer function for the game, also recorded when the game ends.
        function startCountDown(){
            $(".countdown-area").fadeIn(700);
            let seconds = 4;
            let time;
            $(".container").css({
                pointerEvents: "none"
            });
            $(".container").animate({
                opacity: 0.5
            });
            time = setInterval(function(){
                seconds--;
                if(seconds == 0){
                    $(".countdown-area").fadeOut(200);
                    $(".container").css({
                        pointerEvents: "auto"
                    });
                    startGame(difficulty);
                    clearInterval(time);
                    $(".container").css({
                        opacity: 1
                    });
                }
                $(".countdown-area").html(seconds);
            }, 1000);
        }
        // Variables for fatigue and stage events
        let accuracyPenaltyMultiplier = 1;
        let hpReductionMultiplier = 1;
        let pointReduction = 0;
        let hpDecay;
        let tileDensity = 5;

        // Variables for timer function
        let miliseconds = 0;
        let seconds = 0;
        let minutes = 0;
        let hours = 0;
        let totalSeconds = 0; // used for time events
        function startTimer(){
            timerElapsed = setInterval(function(){
                miliseconds += 1;
                if(miliseconds == 10){
                    miliseconds = 0;
                    seconds += 1;
                    totalSeconds += 1;
                }
                if(seconds == 60){
                    seconds = 0;
                    minutes += 1;

                }
                if(minutes == 60){
                    minutes = 0;
                    hours += 1;
                }
                if(totalSeconds == 15){ // 45 seconds in the game 45s Stage 1
                    $("body").css({
                        backgroundColor: "#4488c8"
                    });
                    $(".s-1-box").show().css({
                        opacity: 0,
                        top: '0%'
                    }).animate({
                        opacity: 1,
                        top: '2%'
                    }, 1000).delay(5000).fadeOut(1000);
                }
                if(totalSeconds == 30){ // 1 minute and 30 seconds into the game 90s Stage 2
                    $("body").css({
                        backgroundColor: "#0b238b"
                    });
                    score += 3; // +30 points over a second
                    $(".score").html('<h4>Score: <span style = "color:#2eb8b5"> ' + score + '</span></h4>');
                    if((health + 10) > maxHealth){ // if the health is above the max, set it to the max
                        health = maxHealth;
                    } else {
                        health += 1; // +10 HP over a second
                    }
                    $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                    $(".s-2-box").show().css({
                        opacity: 0,
                        top: '0%'
                    }).animate({
                        opacity: 1,
                        top: '2%'
                    }, 1000).delay(4000).fadeOut(1000);
                    generateClouds();
                }
                if(totalSeconds == 45){ // 2 minutes and 45 seconds into the game 165s Stage 3
                    $("body").css({
                        backgroundColor: "#051e47"
                    });
                    score += 5; // +50 score over a second
                    $(".score").html('<h4>Score: <span style = "color:#2eb8b5"> ' + score + '</span></h4>');
                    if((health + 15) > maxHealth){ // if the health is above the max, set it to the max
                        health = maxHealth;
                    } else {
                        health += 1.5; // +15 HP over a second
                    }
                    $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                    $(".s-3-box").show().css({
                        opacity: 0,
                        top: '0%'
                    }).animate({
                        opacity: 1,
                        top: '2%'
                    }, 1000).delay(4000).fadeOut(1000);
                    fadeClouds();
                }
                if(totalSeconds == 60){ // 3 minutes and 30 seconds into the game 210s Stage 4
                    $("body").css({
                        backgroundColor: "#121212"
                    });
                    score += 8; // +80 score over a second
                    $(".score").html('<h4>Score: <span style = "color:#2eb8b5"> ' + score + '</span></h4>');
                    $(".s-4-box").show().css({
                        opacity: 0,
                        top: '0%'
                    }).animate({
                        opacity: 1,
                        top: '2%'
                    }, 1000).delay(4000).fadeOut(1000);
                    generateStars();
                }

                if(totalSeconds == 75){ // 4 minutes and 30 seconds into the game 270s Fatigue 1
                    $(".fatigue-1").show();
                    accuracyPenaltyMultiplier = 2;
                    health -= 0.5; // -5 HP over a second
                    $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                    if(health <= 0){
                        gameOver();
                    }
                    $(".fatigue-1").show().css({
                        opacity: 0,
                        top: '0%'
                    }).animate({
                        opacity: 1,
                        top: '2%'
                    }, 1000).delay(4000).fadeOut(1000);
                }
                if(totalSeconds == 90) // 5 minutes and 30 seconds into the game 330s Fatigue 2
                {
                    $(".fatigue-2").show();
                    health -= 1; // -10HP over a second
                    $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                    pointReduction = 1;
                    if(health <= 0){
                        gameOver();
                    }
                    $(".fatigue-2").show().css({
                        opacity: 0,
                        top: '0%'
                    }).animate({
                        opacity: 1,
                        top: '2%'
                    }, 1000).delay(4000).fadeOut(1000);
                }
                if(totalSeconds == 105){ // 6 minutes and 15 seconds into the game 375s Fatigue 3
                    $(".fatigue-3").show();
                    hpReductionMultiplier = 2;
                    cycleButtonAmount += 0.5; // add 5 extra buttons per cycle over 1 second
                    $(".fatigue-3").show().css({
                        opacity: 0,
                        top: '0%'
                    }).animate({
                        opacity: 1,
                        top: '2%'
                    }, 1000).delay(4000).fadeOut(1000);
                    hpDecay = setInterval(function(){
                        health -= 0.1 // decay health by 1 over 1 second (0.1 decrement every 100ms)
                        $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1)+ ' HP</span></h4>');
                        if(health <= 0){
                            clearInterval(hpDecay);
                            gameOver();
                        }
                    }, 4000);
                }

                // Fatigue Events
                // Events as the time progresses throughout the game.
                $(".time-elapsed").html('<h4>Time Elapsed: <span style="color:#eba442">' + hours + ':' + minutes + ':' + seconds + '.' + miliseconds + '</span></h4>');
            },100);
        }
        function gameOver(){
            clearInterval(timerElapsed);
            clearInterval(timer);
            inGame = false; // prevent pause from being clicked again
            $(".pause-menu").fadeOut(500);
            $(".over-title").html("Game Over!");
            $(".container").fadeOut(500);
            $(".game-over-menu").delay(1000).fadeIn(1000);
            $(".final-score").html("Your Final Score: <span style='color:gold; font-size:1.5rem;'>" + (score * (accuracy / 100)).toFixed(1) + "</span>");
            $(".g-acc").html("Accuracy: <span style='color:#66f224'>" + accuracy + "%</span>");
            $(".raw-acc").html("Raw Score: <span style='color:#3845d6'>" + score + "</span>");
            $(".p-ups-obtained").html("Powerups Obtained: <span style='color:#eee'>" + totalPowerupsCollected + "</span>");
            $(".time-elapsed").html('Time Elapsed: <span style="color:#eee">' + hours + ':' + minutes + ':' + seconds + '.' + miliseconds + '</span>');
        }
        function generateStars(){
            // When stage 4 is reached, stars will start appearing in the background.
            let starCount = 15; // number of stars to generate * 10
            for (let i = 0; i < starCount; i++) {
                let stars = $('<div class="stars"></div>');
                let randomTop = Math.floor(Math.random() * 100) + 1; // random top position between 1 and 100
                let randomLeft = Math.floor(Math.random() * 100) + 1; // random left position between 1 and 100
                stars.css({
                    position: 'absolute',
                    top: randomTop + 'vh',
                    left: randomLeft + 'vw'
                });
                $('body').append(stars);
            }

        }
        function generateClouds(){
            // When stage 2 is reached, clouds will start appearing in the background, however it will be removed in stage 3.
            let cloudCount = 2; // number of clouds to generate * 10.
            for (let i = 0; i < cloudCount; i++) {
                let clouds = $('<div class="clouds"></div>');
                let randomTop = Math.floor(Math.random() * 100) + 1; // random top position between 1 and 100
                let randomLeft = Math.floor(Math.random() * 100) + 1; // random left position between 1 and 100
                clouds.css({
                    position: 'absolute',
                    top: randomTop + 'vh',
                    left: randomLeft + 'vw'
                });
                $('body').append(clouds);
            }
        }
        function fadeClouds(){
            $(".clouds").fadeOut(2000, function() {
                $(this).remove();
            });
        }

        // The main game starting function
        // all square button declaration here, will be changed depending on the difficulty.\
        let randomEffects = [
            "speedUp",
            "regeneration",
            "haze",
            "glassCannon",
            "shrink"
        ];
        // checking how many times an effect has triggered
        let speedUpCount = 0;
        let regenCount = 0;
        let hazeCount = 0;
        let glassCannonCount = 0;
        let shrinkCount = 0;

        let speedUpTime;
        let regenTime;
        let hazeTime;
        let glassCannonTime;
        let shrinkTime;

        let buttonEffects = [
            "good1",
            "good2",
            "good3",
            "good4",
            "bad1",
            "bad2",
            "bad3",
            "mystery",
            // "effect" // testing remove later
        ];
        let totalButtons;
        let cycleButtonAmount;
        let cycleTime;
        let buttons; // store button data based on difficulty later
        let delay;
        let glassCannonMultiplier = 1; // used for the glass cannon effect
        let baseSpeed;
        let effTimer;
        let startGameTimes = 0; // for resuming button, prevent the difficuly statments being executed again and restoring HP and stuff.
        function startGame(difficulty){
            startTimer();
            inGame = true;
            if(difficulty == "normal" && startGameTimes == 0){
                health = 100;
                maxHealth = 100;
                $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>')
                totalButtons = 25;
                cycleButtonAmount = 9;
                cycleTime = 5000;
                baseSpeed = cycleTime;
                buttons = $(".main-grid-container-normal button"); // collect buttons
                
                
            } 
            if(difficulty == "expert" && startGameTimes == 0){
                health = 50;
                maxHealth = 50;
                $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                totalButtons = 36;
                cycleButtonAmount = 18; // how many buttons can exists in a cycle. 
                cycleTime = 4500;
                baseSpeed = cycleTime;
                
                buttons = $(".main-grid-container-expert button"); // collect buttons
            }
            startGameTimes += 1;
            // select a couple buttons instantly when the game starts.
            selectRandomButtons(buttons, cycleButtonAmount);
            timer = setInterval(function(){
                selectRandomButtons(buttons, cycleButtonAmount);
            }, cycleTime);
        }

        let selectEffect;
        let hasEffect = false;
      
        function selectRandomButtons(buttons , cycleButtonAmount){
            let finalRandomButton = [];
            let selectSingleButton;

             // Roll a random chance for an effect to appear in this specific cycle.
             // If the chance is hit, it will reduce the cycleButtonAmount by 1 and instead replace it with the effect button
             // 10% chance per cycle for an effect to appear
            let chance = Math.floor(Math.random() * 9) + 1;
            if(true){
                hasEffect = true;
                selectEffect = randomEffects[Math.floor(Math.random() * randomEffects.length)];
            }
            for(let i = 0; i < cycleButtonAmount; i++){
                selectSingleButton = Math.floor(Math.random() * buttons.length);
                // finalRandomButton.push(selectSingleButton);
                if(finalRandomButton.includes(selectSingleButton)){
                    // checks for potential duplicates in the event the random number generator gets the same number. (will equal true)
                    // skips the array push entirely and start the loop iteraion over.
                    i--;
                } else {
                    // push data into the array.
                    finalRandomButton.push(selectSingleButton);
                }
            }
            // make the buttons fade in with css for a certain set amount of time, and then fade out.
            // if the buttons are clicked early, then the button will fade out and points will be awarded.
            // if the buttons are not clicked, then the button will fade out, accuracy and health will be deducted.
            // if the user clicks a random blank button, apply the same as above if they were not clicked.
            for(let i = 0; i < finalRandomButton.length; i++){
                // Assign random classes to the buttons for the game.
                let randomSquare = buttonEffects[Math.floor(Math.random() * buttonEffects.length)];
                let button = $(buttons[finalRandomButton[i]]);
                if (hasEffect) {
                    button.attr('id', 'effect');
                    hasEffect = false;
                }
                else{
                    button.attr('id', randomSquare);
                }
                // when a button is clicked
                button.on("click", function(){
                    if (button.attr('id') == 'effect') {
                        totalPowerupsCollected++;
                        for (let i = 0; i < randomEffects.length; i++) {
                            if (randomEffects[i] === selectEffect) {
                                switch (selectEffect) {
                                    case "speedUp":
                                        if(speedUpCount){
                                            clearInterval(speedUpTime);
                                            $(".effects-container").find(".speedUp").remove();
                                            cycleTime = baseSpeed;
                                        }
                                        speedUpCount = true;
                                        cycleTime = cycleTime - 1000; // 1 second faster
                                        $(".effects-container").append('<h4 class="speedUp">Speed Up: 20s</h4>');
                                        let speedUpSeconds = 20;
                                        speedUpTime = setInterval(function() {
                                            if(!isPaused){
                                                speedUpSeconds--;
                                            }
                                            if (speedUpSeconds <= 0) {
                                                clearInterval(speedUpTime);
                                                cycleTime = baseSpeed; // return to normal speed after 20 seconds
                                                $(".effects-container").find(".speedUp").remove();
                                                speedUpCount = false;
                                            }
                                            $(".speedUp").html("Speed Up: " + speedUpSeconds + "s");

                                        }, 1000);
                                        break;
                                    case "regeneration":
                                        if(regenCount){
                                            clearInterval(regenTime);
                                            $(".effects-container").find(".regeneration").remove();
                                        }
                                        regenCount= true;
                                        $(".effects-container").append('<h4 class="regeneration">Regeneration: 15s</h4>');
                                        let regenSeconds = 15;
                                        regenTime = setInterval(function() {
                                            if(!isPaused){
                                                regenSeconds--;
                                            }
                                            $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                                            if((health + 1) < maxHealth){
                                                health += 1;
                                            }
                                            else{
                                                health = 100;
                                            }
                                            if (regenSeconds <= 0) {
                                                clearInterval(regenTime);
                                                $(".effects-container").find(".regeneration").remove();
                                                regenCount = false;
                                            }
                                            $(".regeneration").html("Regeneration: " + regenSeconds + "s");
                                        }, 1000);
                                        break;

                                    case "haze":
                                        hazeEffect = true;
                                        if(hazeCount){
                                            clearInterval(hazeTime);
                                            $(".effects-container").find(".haze").remove();
                                            $(".container").css("opacity", 1);
                                        }
                                        hazeCount = true;
                                        $(".container").css("opacity", 0.45);
                                        $(".effects-container").append('<h4 class="haze">Haze: 15s</h4>');
                                        let hazeSeconds = 15;
                                        hazeTime = setInterval(function() {
                                            if(!isPaused){
                                                hazeSeconds--;
                                            }
                                            if (hazeSeconds <= 0) {
                                                clearInterval(hazeTime);
                                                $(".effects-container").find(".haze").remove();
                                                $(".container").css("opacity", 1);
                                                hazeCount = false;
                                                hazeEffect = false;
                                            }
                                            $(".haze").html("Haze: " + hazeSeconds + "s");
                                        },1000)
                                        break;
                                    case "glassCannon":
                                        if(glassCannonCount){
                                            clearInterval(glassCannonTime);
                                            $(".effects-container").find(".glassCannon").remove();
                                            glassCannonMultiplier = 1;
                                        }
                                        glassCannonCount = true;
                                        glassCannonMultiplier = 2;
                                        let glassSeconds = 15;
                                        $(".effects-container").append('<h4 class="glassCannon">Glass Cannon: 15s</h4>');
                                        glassCannonTime = setInterval(function() {
                                            if(!isPaused){
                                                glassSeconds--;
                                            }
                                            if (glassSeconds <= 0) {
                                                clearInterval(glassCannonTime);
                                                glassCannonMultiplier = 1;
                                                $(".effects-container").find(".glassCannon").remove();
                                                glassCannonCount = false;
                                            }
                                           $(".glassCannon").html("Glass Cannon: " + glassSeconds + "s");
                                        }, 1000);
                                        break;
                                    case "shrink":
                                        if(shrinkCount){
                                            clearInterval(shrinkTime);
                                            $(".main-grid-container-normal button, .main-grid-container-expert button").css("scale", "1");
                                            $(".effects-container").find(".shrink").remove();
                                        }
                                        shrinkCount = true;
                                        $(".main-grid-container-normal button, .main-grid-container-expert button").css("scale", "0.7");
                                        $(".effects-container").append('<h4 class="shrink">Shrink: 15s</h4>');
                                        let shrinkSeconds = 15;
                                        shrinkTime = setInterval(function() {
                                            if(!isPaused){
                                                shrinkSeconds--;
                                            }
                                            if (shrinkSeconds <= 0) {
                                                clearInterval(shrinkTime);
                                                $(".main-grid-container-normal button, .main-grid-container-expert button").css("scale", "1");
                                                $(".effects-container").find(".shrink").remove();
                                                shrinkCount = false;
                                            }
                                            $(".shrink").html("Shrink: " + shrinkSeconds + "s");
                                        }, 1000);
                                        break;  
                                }
                            }
                        }
                        button.removeAttr('id').off("click"); // remove the attribute right after the button is clicked. (.off) will make it no longer responsive to prevent spamming
                        return; // exit the function early
                    }
                    $(this).removeAttr('id').off("click"); // remove the attribute right after the button is clicked. (.off) will make it no longer responsive to prevent spamming
                    // checks which square was clicked gives the appropriate score and health.
                    switch(randomSquare) {
                        case "good1":
                            score += (1 - pointReduction) * glassCannonMultiplier;
                            if(health < maxHealth && (health + 0.5) < maxHealth){
                                health += 0.5;
                            }
                            else{
                                health += (maxHealth - health);
                            }
                            break;
                        case "good2":
                            score += (2 - pointReduction) * glassCannonMultiplier;
                            if(health < maxHealth && (health + 0.5) < maxHealth){
                                health += 0.5;
                            }
                            else{
                                health += (maxHealth - health);
                            }                            
                            break;
                        case "good3":
                            score += (5 - pointReduction) * glassCannonMultiplier;
                            if(health < maxHealth && (health + 0.5) < maxHealth){
                                health += 0.5;
                            }
                            else{
                                health += (maxHealth - health);
                            }
                            break;  
                        case "good4":
                            score += (8 - pointReduction) * glassCannonMultiplier;
                            if(health < maxHealth && (health + 1) < maxHealth){
                                health += 1;
                            }
                            else{
                                health += (maxHealth - health);
                            }
                            break;
                        case "bad1":
                            score -= 3 * glassCannonMultiplier;
                            misses += (1 * accuracyPenaltyMultiplier);
                            health -= 5 * glassCannonMultiplier * hpReductionMultiplier;
                            break;
                        case "bad2":
                            score -= 5 * glassCannonMultiplier;
                            misses += (1 * accuracyPenaltyMultiplier);
                            health -= 7 * glassCannonMultiplier * hpReductionMultiplier;
                            break;
                        case "bad3":
                            score -= 10 * glassCannonMultiplier;
                            misses += (1 * accuracyPenaltyMultiplier);
                            health -= 10 * glassCannonMultiplier * hpReductionMultiplier;
                            break;
                        case "mystery":
                            let randomScore = Math.floor(Math.random() * 31) - 15; // random number between -15 and 15
                            let randomHealth = Math.floor(Math.random() * 8) - 5; // random number between -5 and 2
                            score += randomScore;
                            health += randomHealth;
                            if(health < maxHealth && (health + randomHealth) < maxHealth){
                                health += randomHealth;
                            }
                            else{
                                health += (maxHealth - health);
                            }
                            break;
                    }
                    totalCount++;
                    accuracy = ((totalCount - misses) / totalCount * 100).toFixed(2);
                    if(accuracy < 0){
                        accuracy = 0.01;
                    }
                    $(".score").html('<h4>Score: <span style="color:#2eb8b5">' + score + '</span></h4>');
                    $(".acc").html('<h4>Accuracy: <span style="color:#429820">' + accuracy + '%</span></h4>');
                    $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                    if(health <= 0){
                       gameOver();
                    }
                });
    
                // Fade out the buttons after a certain set amount of time
                delay = setTimeout(function(){
                    // If a good button was not clicked before this timeout function occurs, health will be reduced and so as accuracy.
                    if (button.attr('id') && button.attr('id').includes('good') && !isPaused) {
                        health -= 3 * hpReductionMultiplier;
                        totalCount++;
                        misses += 1
                        accuracy = ((totalCount - misses) / totalCount * 100).toFixed(2);
                        if(accuracy < 0){
                            accuracy = 0.01;
                        }
                        $(".hp").html('<h4>Health: <span style="color:#ec4048"> ' + health.toFixed(1) + ' HP</span></h4>');
                        $(".acc").html('<h4>Accuracy: <span style="color:#429820">' + accuracy + '%</span></h4>');
                        if (health <= 0) {
                           gameOver();
                        }
                    }
                    button.removeAttr('id').off("click"); // prevent clicking using .off
                }, (cycleTime - 1000));
             }
        }
});

</script>
</html>                                 